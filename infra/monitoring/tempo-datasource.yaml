apiVersion: v1
kind: ConfigMap
metadata:
  name: tempo-datasource
  namespace: monitoring
  labels:
    grafana_datasource: "1"
data:
  tempo.yaml: |
    {
      "apiVersion": 1,
      "datasources": [
        {
          "name": "Tempo",
          "type": "tempo",
          "access": "proxy",
          "url": "http://tempo-query-frontend.monitoring.svc.cluster.local:3200",
          "isDefault": false,
          "jsonData": {
            "httpMethod": "GET",
            "tracesToLogs": {
              "datasourceUid": "loki",
              "tags": ["job", "instance", "pod", "namespace"],
              "mapTagNamesEnabled": false,
              "spanStartTimeShift": "1h",
              "spanEndTimeShift": "1h",
              "filterByTraceID": false,
              "filterBySpanID": false
            },
            "tracesToMetrics": {
              "datasourceUid": "prometheus",
              "tags": [
                {
                  "key": "service.name",
                  "value": "service"
                },
                {
                  "key": "job"
                }
              ],
              "queries": [
                {
                  "name": "Sample query",
                  "query": "sum(rate(tempo_spanmetrics_latency_bucket{$$__tags}[5m]))"
                }
              ]
            },
            "nodeGraph": {
              "enabled": true
            },
            "search": {
              "hide": false
            },
            "serviceMap": {
              "datasourceUid": "prometheus"
            }
          }
        }
      ]
    }
